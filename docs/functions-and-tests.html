<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Reproducible Research Bootcamp - 8&nbsp; Modular, Tested Code</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./assertive-testing.html" rel="next">
<link href="./07_advanced-git.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./functions-and-tests.html">Programming</a></li><li class="breadcrumb-item"><a href="./functions-and-tests.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modular, Tested Code</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Reproducible Research Bootcamp</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Abstract</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Syllabus</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_embrace-your-fallibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Embrace Your Fallibility</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Project Organization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_project-organization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Project Organization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Literate Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_advanced-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Advanced Quarto</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Version Control</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_reproducible-research-with-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research with Git and GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_advanced-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Advanced Git and Github</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions-and-tests.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modular, Tested Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assertive-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Modular, Tested Code</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Environment Management</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./renv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title"><code>library(renv)</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Culture and Ethics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./culture-and-ethics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Culture and Ethics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reproducible-research-bootcamp_software-installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Software Requirements</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#fundamental-ideas" id="toc-fundamental-ideas" class="nav-link active" data-scroll-target="#fundamental-ideas"><span class="header-section-number">8.1</span> Fundamental Ideas</a></li>
  <li><a href="#modular-tested-code" id="toc-modular-tested-code" class="nav-link" data-scroll-target="#modular-tested-code"><span class="header-section-number">8.2</span> Modular, Tested Code</a>
  <ul class="collapse">
  <li><a href="#example-functions" id="toc-example-functions" class="nav-link" data-scroll-target="#example-functions"><span class="header-section-number">8.2.1</span> Example Functions</a></li>
  <li><a href="#function-basics" id="toc-function-basics" class="nav-link" data-scroll-target="#function-basics"><span class="header-section-number">8.2.2</span> Function Basics</a></li>
  <li><a href="#functions-with-multiple-outputs" id="toc-functions-with-multiple-outputs" class="nav-link" data-scroll-target="#functions-with-multiple-outputs"><span class="header-section-number">8.2.3</span> Functions with Multiple Outputs</a></li>
  <li><a href="#referential-transparency" id="toc-referential-transparency" class="nav-link" data-scroll-target="#referential-transparency"><span class="header-section-number">8.2.4</span> Referential Transparency</a></li>
  <li><a href="#limitations-of-macros" id="toc-limitations-of-macros" class="nav-link" data-scroll-target="#limitations-of-macros"><span class="header-section-number">8.2.5</span> Limitations of Macros</a></li>
  </ul></li>
  <li><a href="#assertions-in-functions" id="toc-assertions-in-functions" class="nav-link" data-scroll-target="#assertions-in-functions"><span class="header-section-number">8.3</span> Assertions in Functions</a>
  <ul class="collapse">
  <li><a href="#unit-tests-for-functions" id="toc-unit-tests-for-functions" class="nav-link" data-scroll-target="#unit-tests-for-functions"><span class="header-section-number">8.3.1</span> Unit Tests for Functions</a></li>
  </ul></li>
  <li><a href="#custom-r-packages" id="toc-custom-r-packages" class="nav-link" data-scroll-target="#custom-r-packages"><span class="header-section-number">8.4</span> Custom R Packages</a>
  <ul class="collapse">
  <li><a href="#use-this" id="toc-use-this" class="nav-link" data-scroll-target="#use-this"><span class="header-section-number">8.4.1</span> Use This</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./functions-and-tests.html">Programming</a></li><li class="breadcrumb-item"><a href="./functions-and-tests.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modular, Tested Code</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Modular, Tested Code</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<dl>
<dt><img src="images/Lego_Color_Bricks.jpg" class="img-fluid" alt="Log bricks"></dt>
<dd>
<p>Photo by <a href="https://en.wikipedia.org/wiki/Lego#/media/File:Lego_Color_Bricks.jpg">Alan Chia</a></p>
</dd>
</dl>
<div class="cell">
<div id="tbl-roadmap" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-roadmap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.1: Opinionated Analysis Development
</figcaption>
<div aria-describedby="tbl-roadmap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="xdtwcrvzmt" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#xdtwcrvzmt table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#xdtwcrvzmt thead, #xdtwcrvzmt tbody, #xdtwcrvzmt tfoot, #xdtwcrvzmt tr, #xdtwcrvzmt td, #xdtwcrvzmt th {
  border-style: none;
}

#xdtwcrvzmt p {
  margin: 0;
  padding: 0;
}

#xdtwcrvzmt .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xdtwcrvzmt .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#xdtwcrvzmt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xdtwcrvzmt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xdtwcrvzmt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xdtwcrvzmt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xdtwcrvzmt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xdtwcrvzmt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xdtwcrvzmt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xdtwcrvzmt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xdtwcrvzmt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xdtwcrvzmt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xdtwcrvzmt .gt_spanner_row {
  border-bottom-style: hidden;
}

#xdtwcrvzmt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#xdtwcrvzmt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xdtwcrvzmt .gt_from_md > :first-child {
  margin-top: 0;
}

#xdtwcrvzmt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xdtwcrvzmt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xdtwcrvzmt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xdtwcrvzmt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xdtwcrvzmt .gt_row_group_first td {
  border-top-width: 2px;
}

#xdtwcrvzmt .gt_row_group_first th {
  border-top-width: 2px;
}

#xdtwcrvzmt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xdtwcrvzmt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xdtwcrvzmt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xdtwcrvzmt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xdtwcrvzmt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xdtwcrvzmt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xdtwcrvzmt .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#xdtwcrvzmt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xdtwcrvzmt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xdtwcrvzmt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xdtwcrvzmt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xdtwcrvzmt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xdtwcrvzmt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xdtwcrvzmt .gt_left {
  text-align: left;
}

#xdtwcrvzmt .gt_center {
  text-align: center;
}

#xdtwcrvzmt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xdtwcrvzmt .gt_font_normal {
  font-weight: normal;
}

#xdtwcrvzmt .gt_font_bold {
  font-weight: bold;
}

#xdtwcrvzmt .gt_font_italic {
  font-style: italic;
}

#xdtwcrvzmt .gt_super {
  font-size: 65%;
}

#xdtwcrvzmt .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#xdtwcrvzmt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xdtwcrvzmt .gt_indent_1 {
  text-indent: 5px;
}

#xdtwcrvzmt .gt_indent_2 {
  text-indent: 10px;
}

#xdtwcrvzmt .gt_indent_3 {
  text-indent: 15px;
}

#xdtwcrvzmt .gt_indent_4 {
  text-indent: 20px;
}

#xdtwcrvzmt .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="4" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">Opinionated Analysis Development</td>
    </tr>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Opinionated Approach">Opinionated Approach</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Question Addressed">Question Addressed</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Tool<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>">Tool<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Section<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>">Section<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Opinionated Approach" class="gt_row gt_left">Modular, tested, code</td>
<td headers="Question Addressed" class="gt_row gt_left">Can you re-use logic in different parts of the analysis?</td>
<td headers="Tool" class="gt_row gt_left">Well-tested functions</td>
<td headers="Section" class="gt_row gt_center">Programming</td></tr>
    <tr><td headers="Opinionated Approach" class="gt_row gt_left">Modular, tested, code</td>
<td headers="Question Addressed" class="gt_row gt_left">If you decide to change logic, can you change it in just one place?</td>
<td headers="Tool" class="gt_row gt_left">Well-tested functions</td>
<td headers="Section" class="gt_row gt_center">Programming</td></tr>
    <tr><td headers="Opinionated Approach" class="gt_row gt_left">Modular, tested, code</td>
<td headers="Question Addressed" class="gt_row gt_left">If your code is not performing as expected, will you know?</td>
<td headers="Tool" class="gt_row gt_left">Well-tested functions</td>
<td headers="Section" class="gt_row gt_center">Programming</td></tr>
    <tr><td headers="Opinionated Approach" class="gt_row gt_left">Assertive testing of data, assumptions, and results</td>
<td headers="Question Addressed" class="gt_row gt_left">If your data are corrupted, do you notice?</td>
<td headers="Tool" class="gt_row gt_left">library(assertr)</td>
<td headers="Section" class="gt_row gt_center">Programming</td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="4"><strong>Source:</strong> Parker, Hilary. n.d. “Opinionated Analysis Development.” <a href="https://doi.org/10.7287/peerj.preprints.3210v1">https://doi.org/10.7287/peerj.preprints.3210v1</a>.</td>
    </tr>
  </tfoot>
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> Added by Aaron R. Williams</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<section id="fundamental-ideas" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="fundamental-ideas"><span class="header-section-number">8.1</span> Fundamental Ideas</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Defensive programming
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Defensive programming</strong> is a set of practices intended to avoid common mistakes and to catch mistakes with assertions and unit tests.</p>
</div>
</div>
<p><a href="https://swc-osg-workshop.github.io/2017-05-17-JLAB/novice/python/05-defensive.html">Software carpentry</a> and <a href="https://www.nickeubank.com/wp-content/uploads/2016/06/Eubank_EmbraceYourFallibility.pdf">Nick Eubank</a> identify defensive programming as fundamental to avoiding mistakes in an analysis. Defensive programming can also add clarity to an analysis.</p>
<p><a href="https://swc-osg-workshop.github.io/2017-05-17-JLAB/novice/python/05-defensive.html">Software carpentry</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> highlights three parts of defensive programming:</p>
<blockquote class="blockquote">
<ul>
<li>write programs that check their own operation,</li>
<li>write and run tests for widely-used functions, and</li>
<li>make sure we know what “correct” actually means</li>
</ul>
</blockquote>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Unit test
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <strong>unit test</strong> is an evaluation of a function under a preconceived set of conditions that returns TRUE or FALSE based on the output of the function.</p>
</div>
</div>
<p>Unit tests have pre-conceived inputs (e.g.&nbsp;test data) with a pre-conceived set of out outputs.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Assertion
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Assertions</strong> are statements about what must be true at a specific point in a program.</p>
<ul>
<li>Precondition: An assertion about what must be true at the beginning of a function for the function to work correctly. (input tests)</li>
<li>Postcondition: An assertion about what must be true at the end of a function (output tests).</li>
<li>Invariant: A condition that is supposed to be true at a point in time in code.</li>
</ul>
</div>
</div>
<p>Suppose we’re an airplane manufacturer. Unit tests are all of the checks we would run before ever putting passengers on a plane. Does the engine consume fuel at a pre-determined rate? Does the airplane generate sufficient list? Assertions are all of the checks we would run every time the plane is operated. Did the landing gear come down? Do we have enough fuel for this flight distance?</p>
<p>Let’s consider a few important principles of assertions and tests.</p>
<ul>
<li>Definition: Test-driven development is the practice of writing unit tests before writing code and then evaluating the code against the tests. We’ll also consider writing assertions before writing code and evaluating a program against assertions as test-driven development.</li>
<li>Definition: Fail fast, fail often is the principle of working to catch mistakes as soon as they happen. When an error occurs, well-placed tests early in an analysis can minimize the scope of debugging, save computation time, and avoid costly mistakes.</li>
<li>Definition: Fail loudly is the principle that errors should be difficult to ignore. In general, we will favor fatal errors that force us to address the underlying problem before proceeding.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
<li>Definition: Fail clearly is the principle that errors should return meaningful and informative error messages.</li>
</ul>
<p>Below, we’ll take these principles and apply them to building functions, testing data for analysis, and testing the assumptions of an analysis.</p>
</section>
<section id="modular-tested-code" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="modular-tested-code"><span class="header-section-number">8.2</span> Modular, Tested Code</h2>
<p>Functions with unit tests lead to modular, tested code and address three (!) questions from Opinionated Data Analysis:</p>
<blockquote class="blockquote">
<p>Can you re-use logic in different parts of the analysis?</p>
</blockquote>
<p>Functions allow us to reuse bits of R code over and over. In fact, we can iterate functions with for loops and map-reduce.</p>
<blockquote class="blockquote">
<p>If you decide to change logic, can you change it in just one place?</p>
</blockquote>
<p>Functions are the best way to follow the DRY principle. DRY, or <strong>d</strong>on’t <strong>r</strong>epeat <strong>y</strong>ourself, is the principle that we should we should create a function any time we do something three times.</p>
<p>Copying-and-pasting is typically bad because it is easy to make mistakes and we typically want a single source source of truth in a script. Custom functions also promote modular code design and testing.</p>
<p>Suppose we copy and paste the same code with minor changes twenty times. Then, we realize we need to make a change to the core functionality. Now we need to make the change twenty times. If we use a function and need to make a change, we only need to change the code in the function.</p>
<blockquote class="blockquote">
<p>If your code is not performing as expected, will you know?</p>
</blockquote>
<p>Assertions and unit tests that fail fast, fail loudly, and fail clearly are the best way to ensure our code is performing as expected.</p>
<p>The bottom line: we want to write clear functions that do one and only one thing that are sufficiently tested so we are confident in their correctness.</p>
<section id="example-functions" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="example-functions"><span class="header-section-number">8.2.1</span> Example Functions</h3>
<p>Let’s consider a couple of examples from <span class="citation" data-cites="barrientos2021">(<a href="references.html#ref-barrientos2021" role="doc-biblioref"><strong>barrientos2021?</strong></a>)</span>. This paper is a large-scale simulation of formally private mechanisms, which relates to several future chapters of this book.</p>
<p>Division by zero, which returns <code>NaN</code>, can be a real pain when comparing confidential and noisy results when the confidential value is <code>zero</code>. This function simply returns <code>0</code> when the denominator is <code>0</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">#' Safely divide number. When zero is in the denominator, return 0. </span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">#'</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#' @param numerator A numeric value for the numerator</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">#' @param denominator A numeric value for the denominator</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#'</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">#' @return A numeric ratio</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#'</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>safe_divide <span class="ot">&lt;-</span> <span class="cf">function</span>(numerator, denominator) {</span>
<span id="cb1-9"><a href="#cb1-9"></a>  </span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="cf">if</span> (denominator <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb1-11"><a href="#cb1-11"></a>    </span>
<span id="cb1-12"><a href="#cb1-12"></a>    <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb1-13"><a href="#cb1-13"></a>    </span>
<span id="cb1-14"><a href="#cb1-14"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-15"><a href="#cb1-15"></a>    </span>
<span id="cb1-16"><a href="#cb1-16"></a>    <span class="fu">return</span>(numerator <span class="sc">/</span> denominator)</span>
<span id="cb1-17"><a href="#cb1-17"></a>    </span>
<span id="cb1-18"><a href="#cb1-18"></a>  }</span>
<span id="cb1-19"><a href="#cb1-19"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function</p>
<ol type="1">
<li>Implements the laplace or double exponential distribution, which isn’t included in base R.</li>
<li>Applies a technique called the laplace mechanism.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">#' Apply the laplace mechanism</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#'</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#' @param eps Numeric epsilon privacy parameter</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#' @param gs Numeric global sensitivity for the statistics of interest</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#'</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#' @return</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#' </span></span>
<span id="cb2-8"><a href="#cb2-8"></a>lap_mech <span class="ot">&lt;-</span> <span class="cf">function</span>(eps, gs) {</span>
<span id="cb2-9"><a href="#cb2-9"></a>  </span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="co"># Checking for proper values</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>  <span class="cf">if</span> (<span class="fu">any</span>(eps <span class="sc">&lt;=</span> <span class="dv">0</span>)) {</span>
<span id="cb2-12"><a href="#cb2-12"></a>    <span class="fu">stop</span>(<span class="st">"The eps must be positive."</span>)</span>
<span id="cb2-13"><a href="#cb2-13"></a>  }</span>
<span id="cb2-14"><a href="#cb2-14"></a>  <span class="cf">if</span> (<span class="fu">any</span>(gs <span class="sc">&lt;=</span> <span class="dv">0</span>)) {</span>
<span id="cb2-15"><a href="#cb2-15"></a>    <span class="fu">stop</span>(<span class="st">"The GS must be positive."</span>)</span>
<span id="cb2-16"><a href="#cb2-16"></a>  }</span>
<span id="cb2-17"><a href="#cb2-17"></a>  </span>
<span id="cb2-18"><a href="#cb2-18"></a>  <span class="co"># Calculating the scale</span></span>
<span id="cb2-19"><a href="#cb2-19"></a>  scale <span class="ot">&lt;-</span> gs <span class="sc">/</span> eps</span>
<span id="cb2-20"><a href="#cb2-20"></a></span>
<span id="cb2-21"><a href="#cb2-21"></a>  r <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb2-22"><a href="#cb2-22"></a></span>
<span id="cb2-23"><a href="#cb2-23"></a>  <span class="cf">if</span>(r <span class="sc">&gt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb2-24"><a href="#cb2-24"></a>    r2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> r</span>
<span id="cb2-25"><a href="#cb2-25"></a>    x <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">-</span> <span class="fu">sign</span>(r <span class="sc">-</span> <span class="fl">0.5</span>) <span class="sc">*</span> scale <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">2</span> <span class="sc">*</span> r2)</span>
<span id="cb2-26"><a href="#cb2-26"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-27"><a href="#cb2-27"></a>    x <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">-</span> <span class="fu">sign</span>(r <span class="sc">-</span> <span class="fl">0.5</span>) <span class="sc">*</span> scale <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">2</span> <span class="sc">*</span> r)</span>
<span id="cb2-28"><a href="#cb2-28"></a>  }</span>
<span id="cb2-29"><a href="#cb2-29"></a>  </span>
<span id="cb2-30"><a href="#cb2-30"></a>  <span class="fu">return</span>(x)</span>
<span id="cb2-31"><a href="#cb2-31"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="function-basics" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="function-basics"><span class="header-section-number">8.2.2</span> Function Basics</h3>
<p>R has a robust system for creating custom functions. To create a custom function, use <code>function()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>say_hello <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb3-2"><a href="#cb3-2"></a>  </span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="st">"hello"</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>   </span>
<span id="cb3-5"><a href="#cb3-5"></a>}</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="fu">say_hello</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hello"</code></pre>
</div>
</div>
<p>Oftentimes, we want to pass parameters/arguments to our functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>say_hello <span class="ot">&lt;-</span> <span class="cf">function</span>(name) {</span>
<span id="cb5-2"><a href="#cb5-2"></a>  </span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">paste</span>(<span class="st">"hello,"</span>, name)</span>
<span id="cb5-4"><a href="#cb5-4"></a>   </span>
<span id="cb5-5"><a href="#cb5-5"></a>}</span>
<span id="cb5-6"><a href="#cb5-6"></a></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="fu">say_hello</span>(<span class="at">name =</span> <span class="st">"aaron"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hello, aaron"</code></pre>
</div>
</div>
<p>We can also specify default values for parameters/arguments:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>say_hello <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">name =</span> <span class="st">"aaron"</span>) {</span>
<span id="cb7-2"><a href="#cb7-2"></a>  </span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">paste</span>(<span class="st">"hello,"</span>, name)</span>
<span id="cb7-4"><a href="#cb7-4"></a>   </span>
<span id="cb7-5"><a href="#cb7-5"></a>}</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="fu">say_hello</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hello, aaron"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">say_hello</span>(<span class="at">name =</span> <span class="st">"alex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hello, alex"</code></pre>
</div>
</div>
<p><code>say_hello()</code> just prints something to the console. More often, we want to perform a bunch of operations and the then return some object like a vector or a data frame. By default, R will return the last unassigned object in a custom function. It isn’t required, but it is good practice to wrap the object to return in <code>return()</code>.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 1</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create a function called <code>say_goodbye()</code> that says goodbye.</li>
<li>Give it a <code>name</code> argument and a default value for <code>name</code>.</li>
</ol>
</div>
</div>
<p>It’s also good practice to document functions. With your cursor inside of a function, go Insert &gt; Insert Roxygen Skeleton:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">#' Say hello</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co">#'</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">#' @param name A character vector with names</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">#'</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">#' @return A character vector with greetings to name</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">#' </span></span>
<span id="cb11-7"><a href="#cb11-7"></a>say_hello <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">name =</span> <span class="st">"aaron"</span>) {</span>
<span id="cb11-8"><a href="#cb11-8"></a>  </span>
<span id="cb11-9"><a href="#cb11-9"></a>  greeting <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"hello,"</span>, name)</span>
<span id="cb11-10"><a href="#cb11-10"></a>  </span>
<span id="cb11-11"><a href="#cb11-11"></a>  <span class="fu">return</span>(greeting)</span>
<span id="cb11-12"><a href="#cb11-12"></a>  </span>
<span id="cb11-13"><a href="#cb11-13"></a>}</span>
<span id="cb11-14"><a href="#cb11-14"></a></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="fu">say_hello</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hello, aaron"</code></pre>
</div>
</div>
<p>As you can see from the <a href="https://jozef.io/r102-addin-roxytags/">Roxygen Skeleton</a> template above, function documentation should contain the following:</p>
<ul>
<li>A description of what the function does</li>
<li>A description of each function argument, including the class of the argument (e.g.&nbsp;string, integer, dataframe)</li>
<li>A description of what the function returns, including the class of the object</li>
</ul>
<p>Tips for writing functions:</p>
<ul>
<li>Function names should be short but effectively describe what the function does. Function names should generally be verbs while function arguments should be nouns. See the <a href="https://style.tidyverse.org/functions.html">Tidyverse style guide</a> for more details on function naming and style.</li>
<li>As a general principle, functions should each do only one task. This makes it much easier to debug your code and reuse functions!</li>
<li>Use <code>::</code> (e.g.&nbsp;<code>dplyr::filter()</code> instead of <code>filter()</code>) when writing custom functions. This will create stabler code and make it easier to develop R packages.</li>
</ul>
</section>
<section id="functions-with-multiple-outputs" class="level3" data-number="8.2.3">
<h3 data-number="8.2.3" class="anchored" data-anchor-id="functions-with-multiple-outputs"><span class="header-section-number">8.2.3</span> Functions with Multiple Outputs</h3>
<p>When <code>return()</code> is reached in a function, <code>return()</code> is evaluated, evaluation ends and R leaves the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>sow_return <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb13-2"><a href="#cb13-2"></a>  </span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">return</span>(<span class="st">"The function stops!"</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a>  </span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="fu">return</span>(<span class="st">"This never happens!"</span>)</span>
<span id="cb13-6"><a href="#cb13-6"></a>  </span>
<span id="cb13-7"><a href="#cb13-7"></a>}</span>
<span id="cb13-8"><a href="#cb13-8"></a></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="fu">sow_return</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The function stops!"</code></pre>
</div>
</div>
<p>If the end of a function is reached without calling <code>return()</code>, the value from the last evaluated expression is returned.</p>
<p>We prefer to include <code>return()</code> at the end of functions for clarity even though <code>return()</code> doesn’t change the behavior of the function.</p>
</section>
<section id="referential-transparency" class="level3" data-number="8.2.4">
<h3 data-number="8.2.4" class="anchored" data-anchor-id="referential-transparency"><span class="header-section-number">8.2.4</span> Referential Transparency</h3>
<p>R functions, like mathematical functions, should always return the exact same output for a given set of inputs.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> This is called referential transparency. R will not enforce this idea, so you must write good code.</p>
<section id="bad" class="level4">
<h4 class="anchored" data-anchor-id="bad">Bad!</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>bad_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb15-2"><a href="#cb15-2"></a>  </span>
<span id="cb15-3"><a href="#cb15-3"></a>  x <span class="sc">*</span> y</span>
<span id="cb15-4"><a href="#cb15-4"></a>  </span>
<span id="cb15-5"><a href="#cb15-5"></a>}</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="fu">bad_function</span>(<span class="at">x =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>y <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="fu">bad_function</span>(<span class="at">x =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
</section>
<section id="good" class="level4">
<h4 class="anchored" data-anchor-id="good">Good!</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>good_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb19-2"><a href="#cb19-2"></a>  </span>
<span id="cb19-3"><a href="#cb19-3"></a>  x <span class="sc">*</span> y</span>
<span id="cb19-4"><a href="#cb19-4"></a>  </span>
<span id="cb19-5"><a href="#cb19-5"></a>}</span>
<span id="cb19-6"><a href="#cb19-6"></a>  </span>
<span id="cb19-7"><a href="#cb19-7"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="fu">good_function</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>y <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">good_function</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p>Bruno Rodriguez has a <a href="http://modern-rstats.eu/functional-programming.html#properties-of-functions">book</a> and a <a href="https://www.brodrigues.co/blog/2022-05-26-safer_programs/">blog</a> that explore this idea further.</p>
</section>
</section>
<section id="limitations-of-macros" class="level3" data-number="8.2.5">
<h3 data-number="8.2.5" class="anchored" data-anchor-id="limitations-of-macros"><span class="header-section-number">8.2.5</span> Limitations of Macros</h3>
<p>Macros are popular in Stata and SAS. Macros promote DRY programming and modular programming.</p>
<p>Functions have environments, which means an object in a function doesn’t exist outside of the function unless it is explicitly returned. Macros rely on textual substitution, which makes it easy for an object in a function to affect objects outside of a function.</p>
</section>
</section>
<section id="assertions-in-functions" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="assertions-in-functions"><span class="header-section-number">8.3</span> Assertions in Functions</h2>
<p><code>stopifnot()</code>, <code>stop()</code>, and <code>warning()</code> are useful functions for implementing assertions inside custom functions. <code>stopifnot()</code> is easier to use but <code>stop()</code> allows for detailed error messages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>sum_integers <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb23-2"><a href="#cb23-2"></a>  </span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">stopifnot</span>(<span class="fu">class</span>(x) <span class="sc">==</span> <span class="st">"integer"</span>)</span>
<span id="cb23-4"><a href="#cb23-4"></a>  </span>
<span id="cb23-5"><a href="#cb23-5"></a>  x_sum <span class="ot">&lt;-</span> <span class="fu">sum</span>(x)</span>
<span id="cb23-6"><a href="#cb23-6"></a>  </span>
<span id="cb23-7"><a href="#cb23-7"></a>  <span class="fu">return</span>(x_sum)</span>
<span id="cb23-8"><a href="#cb23-8"></a>  </span>
<span id="cb23-9"><a href="#cb23-9"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">sum_integers</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Error in sum_integers(x = c(1, 2)) : class(x) == "integer" is not TRUE</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>sum_integers <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb26-2"><a href="#cb26-2"></a>  </span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="cf">if</span> (<span class="fu">class</span>(x) <span class="sc">!=</span> <span class="st">"integer"</span>) {</span>
<span id="cb26-4"><a href="#cb26-4"></a>    <span class="fu">stop</span>(<span class="st">"Error: input vector x must be of class integer"</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a>  }</span>
<span id="cb26-6"><a href="#cb26-6"></a>  </span>
<span id="cb26-7"><a href="#cb26-7"></a>  x_sum <span class="ot">&lt;-</span> <span class="fu">sum</span>(x)</span>
<span id="cb26-8"><a href="#cb26-8"></a>  </span>
<span id="cb26-9"><a href="#cb26-9"></a>  <span class="fu">return</span>(x_sum)</span>
<span id="cb26-10"><a href="#cb26-10"></a>  </span>
<span id="cb26-11"><a href="#cb26-11"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">sum_integers</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Error in sum_integers(x = c(1, 2)) : 
  Error: input vector x must be of class integer</code></pre>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 2</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Add an precondition assertion to <code>say_goodbye()</code> to test if the input is a character string. <code>is.character()</code> is useful.</li>
</ol>
</div>
</div>
<section id="unit-tests-for-functions" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="unit-tests-for-functions"><span class="header-section-number">8.3.1</span> Unit Tests for Functions</h3>
<p><code>library(testthat)</code> is a powerful framework for unit testing</p>
<p><code>library(testthat)</code> uses two big ideas: <strong>expectations</strong> and <strong>tests</strong>.</p>
<p>Expectations compare the output of the function against expected output. Consider the <code>sum_integer()</code> from earlier. We can write an expectation that the function throws an error with incorrect inputs and we can write an expectation that the function returns an integer when it has the correct inputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb29-2"><a href="#cb29-2"></a></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="fu">expect_error</span>(<span class="fu">sum_integers</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)))</span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="fu">expect_type</span>(<span class="fu">sum_integers</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">2</span>L)), <span class="at">type =</span> <span class="st">"integer"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tests group multiple expectations together and begins with <code>test_that()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">test_that</span>(<span class="st">"sum_integers() tests inputs and returns the correct output"</span>, {</span>
<span id="cb30-2"><a href="#cb30-2"></a>  </span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">expect_error</span>(<span class="fu">sum_integers</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)))</span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="fu">expect_type</span>(<span class="fu">sum_integers</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">2</span>L)), <span class="at">type =</span> <span class="st">"integer"</span>)</span>
<span id="cb30-5"><a href="#cb30-5"></a>  </span>
<span id="cb30-6"><a href="#cb30-6"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🥇</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Test coverage
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Test coverage</strong> is the scope and quality of tests performed on a code base.</p>
</div>
</div>
<p>The goal to develop tests with good test coverage that will loudly fail when bugs are introduced into code.</p>
</section>
</section>
<section id="custom-r-packages" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="custom-r-packages"><span class="header-section-number">8.4</span> Custom R Packages</h2>
<p>If we have R functions with roxygen headers and tests, then we almost have an R package.</p>
<p>At some point, the same scripts or data are used often enough or widely enough to justify moving from sourced R scripts to a full-blown R package. R packages make it easier to</p>
<ol type="1">
<li>Make it easier to share and version code.</li>
<li>Improve documentation of functions and data.</li>
<li>Make it easier to test code.</li>
<li>Often lead to fun hex stickers.</li>
</ol>
<section id="use-this" class="level3" data-number="8.4.1">
<h3 data-number="8.4.1" class="anchored" data-anchor-id="use-this"><span class="header-section-number">8.4.1</span> Use This</h3>
<p><code>library(usethis)</code> includes an R package template. The following will add all necessary files for an R package to a directory called <code>testpackage/</code> and open an RStudio package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">library</span>(usethis)</span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="fu">create_package</span>(<span class="st">"/Users/adam/testpackage"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We won’t cover the rest of R package development but a custom R package is easier to make than it sounds. The <a href="https://r-pkgs.org/">second edition of R Packages</a> by Hadley Wickham and Jennifer Bryant is a great free resource to learn more.</p>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p><a href="https://www.nickeubank.com/wp-content/uploads/2016/06/Eubank_EmbraceYourFallibility.pdf">Nick Eubank</a> identifies adding tests, never transcribe, style matters, and don’t duplicate information. Many of the ideas are scattered throughout this training.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Recall, Quarto requires the code to run error-free for the document to render.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>This rule won’t exactly hold if the function contains random or stochastic code. In those cases, the function should return the same output every time if the seed is set with <code>set.seed()</code>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./07_advanced-git.html" class="pagination-link" aria-label="Advanced Git and Github">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Advanced Git and Github</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./assertive-testing.html" class="pagination-link" aria-label="Modular, Tested Code">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Modular, Tested Code</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>